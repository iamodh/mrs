# MRS
Marathon Registration System
마라톤 신청과 관리를 위한 웹 어플리케이션

## 제작 배경
- 마라톤 대회에 신청하려고 했는데, 신청 페이지에서 서버 오류 메시지가 그대로 표시됨.
  - 전화로 문의한 결과 신청 인원이 다 차서 조기 마감되었음을 확인할 수 있었음.

- 개최측에서 엑셀 파일을 검토한 결과 중복 신청자가 존재했음.
  - 나와 친구는 중복 신청자를 제거한 빈 자리에 들어갈 수 있었음.

- 신청이 처리된 이후 갑작스럽게 환불 완료 문자를 받음.
  - 개최측의 실수로 환불자에게만 전송됐어야 할 메시지가 신청자 모두에게 전송됨.


## 목적
- 조기 마감, 중복 신청에 대처 가능한 실시간 웹 어플리케이션 제작.

  - 신청자가 신청 현황을 확인할 수 있도록 개선하여 불필요한 전화 문의 감소.

- 관리자 페이지에서 필터링된 신청자들에게 자동으로 문자를 전송하는 기능 구현.

  - 관리자의 실수 가능성을 제거하여 불필요한 자원 소모(메시지 전송 비용) 경감.

## 요구사항

### User

- 실시간 신청 실시간 신청 현황(신청자 수, 모집 인원 수)을 확인할 수 있어야 한다. (M)

- 신청자 정보(이름, 주소, 생년월일, 종목, 휴대폰 번호)를 입력한 뒤 마라톤에 신청을 할 수 있어야 한다. (M)
- 마라톤 신청시 결제를 할 수 있어야 한다.
- 신청 마감 전 신청을 취소할 수 있어야 한다. (M)
- 신청 마감이 지난 후 환불을 진행할 수 있어야 한다. (M)

### Admin

- 신청자 목록을 확인할 수 있어야 한다. (M)

- 신청자 목록을 이름, 생년월일, 종목을 기준으로 정렬할 수 있어야 한다. (M)
- 신청자 목록을 환불 여부를 기준으로 필터링할 수 있어야 한다. (M)
- 모든 신청자들에게 문자를 보낼 수 있어야 한다.
- 환불자들에게만 문자를 보낼 수 있어야 한다.
  - 선택한 신청자 중 환불자가 아닌 신청자가 존재할 경우 환불 문자를 전송할 수 없어야 한다.
- 선택한 신청자들에게 문자를 보낼 수 있어야 한다.
- 신청자 목록을 엑셀 파일로 추출할 수 있어야 한다.

> M은 MVP 기능을 말함.

## 주요 포인트

### 보안
- 신청자의 개인 정보 보호가 우선되어야 함.

  - ~신청자(user)와 관리자(admin) 어플리케이션을 분리 제작 후, 관리자에게 직접 admin 어플리케이션 제공.~
  - 데이터베이스 모델 공유와 코드 재사용을 위해 모놀리스 구조 선택. (추가 확장시 분라 고려.)
- Rails가 제공하는 기본 보안 솔루션 공부 후 보안 사각지대 확인 필요.

### 실시간 기능 제공
- 신청이 완료된 후 실시간으로 신청 현황이 업데이트되어야 함.
  
- 모집 인원이 500명, 신청자가 499명인 상황에서 두 신청자가 동시에 신청했을 때 우선 신청 기준 확립 필요.

### 유효성 검사
- 신청자 또는 관리자가 실수로 잘못된 행동을 하여도 소프트웨어가 방어해줄 수 있어야 함.

### 정렬, 필터링
- 다양한 기준에서 정렬과 필터링 기능이 정확하게 동작되어야 함.

## 기술 스택

### Framework
- Ruby on Rails
  
  - MVC 디자인 패턴을 기반으로 한 객체지향 웹 어플리케이션 제작 프레임워크로 기능 확장이 용이.
  - Active Record, form_with와 같이 빠른 개발에 필요한 Gem와 헬퍼 함수를 제공.
### DB
- PostgreSQL
  - 다중 버전 동시성 제어(MVVC) 지원으로 읽기 작업과 쓰기 작업이 서로를 방해하지 않음.
    - 트래픽이 몰리는 순간에도 매끄러운 데이터 확인이 가능.
      
  - 다양한 인덱싱 알고리즘(GIN, Partial Index 등)을 사용하여 정렬, 필터링 기능 구현시 높은 성능 제공.
  - array, JSONB 등 다양한 데이터 유형 사용
    - 신청서 양식이 바뀌더라도 JSONB를 사용해 유연한 대처 가능.
  - 보안 설정, 유효성 검사를 위한 다양한 고급 기능 제공.
    - RLS 사용으로 신청자, 관리자의 데이터 접근 권한을 행 단위로 관리
    - LOCK 사용으로 한 자리가 남은 상황에서 두 신청자가 동시에 신청을 완료했을 때 이후 신청자는 실패 처리.
 
### Deploy & Infra
- Kamal
  - Rails가 사용하는 배포 도구로 쉬운 Docker 설정 가능.
    
- Docker
  - 어플리케이션 실행에 필요한 파일들 패키징
  - ~하나의 서버에서 user, admin 컨테이너를 띄워 서버 비용 절감.~
    
- AWS
  - EC2 : user, admin 앱
  - RDB : 신청자 데이터 관리
  - Route55 : 도메인 관리

## 계획
> 목표 : 1/3(토)까지 MVP 구현, 기획서 작성 후 대회 관계자에게 전달

- 12/22(월), 12/23(화)
  - 요구사항 정의, 기술 스택 조사, 개발 계획 수립

- 12/24(수)
  - user 설계
  - admin 설계

- 12/25(목), 12/26(금)
  - 개인 일정

- 12/27(토), 12/28(일), 12/29(월)
  - user MVP 구현

- 12/30(화), 12/31(수)
  - admin MVP 구현
  
- 1/1(목)
  - 배포
  
- 1/2(금)
  - 기획서 작성
  
## 설계
<table><thead>
  <tr>
    <th>협력 모델</th>
    <th>도메인 모델</th>
  </tr></thead>
<tbody>
  <tr>
    <td>
      <img height="400" alt="image" src="https://github.com/user-attachments/assets/3bffce32-c2aa-4a22-bfaf-81f7037d9605" />
    </td>
    <td>
      <img height="400" alt="image" src="https://github.com/user-attachments/assets/0013e399-65cd-4673-9b0f-ef39b0c0ff15" />
    </td>
  </tr>
</tbody>
</table>

## 와이어프레임
<img width="3934" height="1855" alt="image" src="https://github.com/user-attachments/assets/0d63d94c-8311-435f-ac49-02957cfe2d35" />

